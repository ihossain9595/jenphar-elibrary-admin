<!-- * HEAD * -->
<%- include('../includes/admin_layout/head.ejs') %>
<!-- * HEAD * -->

<body>
  <!-- * NAVBAR - START * -->
  <%- include('../includes/admin_layout/navbar_start.ejs') %>
  <!-- * NAVBAR - START * -->

  <!-- ! MAIN ! -->
  <section class="main_box">
    <div class="content_box">
      <div id="intro_box">
        <div class="left_box">
          <p class="sub_title">Quiz</p>
          <h1 class="title"><%=title%></h1>
        </div>
        <div class="right_box">
          <a class="button_add" href="/admin/quiz/add-quiz">Add New Quiz</a>
        </div>
      </div>

      <hr class="line" />

      <!-- ERROR -->
      <div id="error_full">
        <% if (messages.error) { %>
        <div class="message_error">Error! <%- messages.error %></div>
        <% } %> <% if (messages.success) { %>
        <div class="message_success">Success! <%- messages.success %></div>
        <% } %>
      </div>
      <!-- ERROR -->

      <main id="quiz_list">
        <table id="data_list" class="table datatable-basic table-bordered table-striped table-hover">
          <thead class="head">
            <tr>
              <th>Name</th>
              <th>Duration</th>
              <th>Category</th>
              <th>Start</th>
              <th>End</th>
              <th>Status</th>
              <th>Action</th>
            </tr>
          </thead>

          <tbody class="body"></tbody>
        </table>
      </main>
    </div>
  </section>
  <!-- ! MAIN ! -->

  <!-- * NAVBAR - END * -->
  <%- include('../includes/admin_layout/navbar_end.ejs') %>
  <!-- * NAVBAR - END * -->
</body>

<!-- * FOOT * -->
<%- include('../includes/admin_layout/foot.ejs') %>
<!-- * FOOT * -->

<!-- * SCRIPT * -->
<script>
  const options = {
    year: "numeric",
    month: "long",
    day: "numeric",
    hour: "2-digit",
    minute: "2-digit",
    second: "2-digit",
  };

  function changeDateTimeFormat(oldDateTime) {
    const dateTime = new Date(oldDateTime);
    const formattedDateTime = dateTime.toLocaleDateString("en-US", options);
    return formattedDateTime;
  }

  $(document).ready(function () {
    function dataLoad() {
      $("#data_list").DataTable({
        processing: true,
        serverSide: true,
        ordering: false,
        search: false,
        destroy: true,
        pageLength: 50,
        ajax: {
          url: "/admin/quiz-list/data-list",
          type: "POST",
          datatype: "json",
        },
        createdRow: function (row, data, dataIndex) {
          $("td:eq(0)", row).html("<a href='/admin/quiz/question-list/" + data.id + "'> " + data.name + "</a>");
          if (data.status === "Published") {
            $("td:eq(5)", row).html('<span class="badge badge-success">Published</span>');
          } else {
            $("td:eq(5)", row).html('<span class="badge badge-secondary">Unpublished</span>');
          }
          $("td:eq(3)", row).html("<span>" + changeDateTimeFormat(data.start_time) + "</span>");
          $("td:eq(4)", row).html("<span>" + changeDateTimeFormat(data.end_time) + "</span>");
        },
        columns: [{ data: "name" }, { data: "time_duration" }, { data: "category" }, { data: "start_time" }, { data: "end_time" }, { data: "status" }, { data: "action" }],
      });
    }

    dataLoad();

    // Custom bootbox dialog with form
    $("#data_list").on("click", "#delete", function () {
      var delid = $(this).attr("data-delete-id");
      bootbox.confirm({
        title: "Delete",
        message: "Do you want to delete?",
        buttons: {
          confirm: {
            label: "Yes",
            className: "btn-primary",
          },
          cancel: {
            label: "No",
            className: "btn-link",
          },
        },
        callback: function (result) {
          if (result) {
            $.ajax({
              type: "post",
              url: "/admin/quiz-list/del",
              data: { del_id: delid },
              datatype: "json",
              traditional: true,
              success: function (data) {
                if (data.success) {
                  window.location.href = "/admin/quiz/quiz-list";
                } else {
                  bootbox.alert({
                    title: "Delete Faild!",
                    message: data.message,
                  });
                }
              },
            });
          }
        },
      });
    });

    $("#filter").click(function () {
      dataLoad();
    });
  });
</script>
<!-- * SCRIPT * -->
